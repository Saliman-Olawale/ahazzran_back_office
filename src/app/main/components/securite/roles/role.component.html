<div class="grid">
    <div class="col-12">
        <div class="card px-6 py-6">
            <p-toast></p-toast>
            <p-toolbar styleClass="mb-4">
                <ng-template pTemplate="left">
                    <div class="my-2">
                        <button pButton pRipple label="Nouveau" icon="pi pi-plus" class="p-button-success mr-2" (click)="openNew()"></button>
                    </div>
                </ng-template>
            </p-toolbar>

            <p-table [value]="roles" [rows]="10" [paginator]="true" [pageLinks]="3" [rowsPerPageOptions]="rowsPerPageOptions"
                     [globalFilterFields]="['designation', 'codeRole']" #dt (onFilter)="onGlobalFilter(dt, $event)">
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="designation">Designation <p-sortIcon field="designation"></p-sortIcon></th>
                        <th pSortableColumn="codeRole">Code de rôle <p-sortIcon field="codeRole"></p-sortIcon></th>
                        <th pSortableColumn="active">Statut <p-sortIcon field="active"></p-sortIcon></th>
                        <th>Permissions</th>
                        <th>Actions</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-role>
                    <tr>
                        <td>{{ role.designation }}</td>
                        <td>{{ role.codeRole }}</td>
                        <td>
                            <p-button [label]="role.active ? 'Actif' : 'Inactif'" 
                            [className]="role.active ? 'p-button-success' : 'p-button-danger'"
                            (onClick)="setStatus(role)"></p-button>
                        </td>
                        <td>
                            <ul>
                                <li *ngFor="let permission of role.permissions">
                                    {{ getPermissionLabel(permission.permissionId) }}
                                </li>
                            </ul>
                        </td>
                        <td>
                            <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2" (click)="editRole(role)"></button>
                            <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning" (click)="confirmDelete(role)"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>

            <!-- Dialog for Role Details -->
            <p-dialog [(visible)]="roleDialog" [style]="{width: '450px'}" header="Détails du rôle" [modal]="true" styleClass="p-fluid">
                <ng-template pTemplate="content">
                    <div class="p-field">
                        <label for="designation">Désignation</label>
                        <input type="text" pInputText id="designation" [(ngModel)]="role.designation" required autofocus />
                    </div>
                    <div class="p-field">
                        <label for="codeRole">Code de rôle</label>
                        <input type="text" pInputText id="codeRole" [(ngModel)]="role.codeRole" required />
                    </div>
                    <div class="field">
                        <label for="permissions">Permissions</label>
                        <p-multiSelect options="permissions" ngModel="role.permissions" optionLabel="permissionName" optionValue="id" placeholder="Sélectionnez les permissions">
                        </p-multiSelect>
                    </div>
                </ng-template>
                <ng-template pTemplate="footer">
                    <button pButton pRipple label="Annuler" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
                    <button pButton pRipple label="Sauvegarder" icon="pi pi-check" class="p-button-text" (click)="saveRole()"></button>
                </ng-template>
            </p-dialog> 

            <!-- Confirmation Dialog for Deleting Role -->
            <p-dialog header="Confirmation" [(visible)]="deleteRoleDialog"  [style]="{ width: '30vw' }">
                <div class="p-d-flex p-jc-center">
                    <span>Êtes-vous sûr de vouloir supprimer ce rôle?</span>
                </div>
                <p-footer>
                    <button pButton type="button" label="Oui" icon="pi pi-check" (click)="deleteRole()"></button>
                    <button pButton type="button" label="Non" icon="pi pi-times" class="p-button-secondary" (click)="hideDialog()"></button>
                </p-footer>
            </p-dialog>
        </div>
    </div>
</div>